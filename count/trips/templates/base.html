<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Logística{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap JS (para que funcionen los modals) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">


</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'trips:trip_list' %}">Logística</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" href="{% url 'trips:trip_list' %}">Viajes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'trips:invoice_list' %}">Facturación</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'trips:clients_list' %}">Clientes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'trips:drivers_list' %}">Conductores</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'trips:vehicles_list' %}">Vehículos</a>
        </li>
      </ul>
      {% if user.is_authenticated %}
      <span class="navbar-text me-3">{{ user.email }}</span>
      <a class="btn btn-outline-light btn-sm" href="{% url 'logout' %}">Salir</a>
      {% endif %}
    </div>
  </div>
</nav>

<div class="container">
  {% block content %}{% endblock %}
</div>

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const driverSelect = document.getElementById("id_driver");
    const vehicleSelect = document.getElementById("id_vehicle");

    driverSelect.addEventListener("change", function () {
        const driverId = this.value;
        if (!driverId) return;

        fetch(`/ajax/get_vehicles_by_driver/?driver_id=${driverId}`)
            .then(response => response.json())
            .then(data => {
                vehicleSelect.innerHTML = ""; // Limpiar opciones

                if (data.length === 0) {
                    const option = document.createElement("option");
                    option.textContent = "No hay vehículos disponibles";
                    option.disabled = true;
                    option.selected = true;
                    vehicleSelect.appendChild(option);
                    return;
                }

                data.forEach((vehicle, index) => {
                    const option = document.createElement("option");
                    option.value = vehicle.id;
                    option.textContent = `${vehicle.plate} - ${vehicle.description}`;
                    if (index === 0) {
                        option.selected = true;
                    }
                    vehicleSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error("Error al cargar vehículos:", error);
            });
    });
});

  document.addEventListener("DOMContentLoaded", function () {
    const addBtn = document.getElementById("add-address-btn");
    const formContainer = document.getElementById("address-forms");
    const totalForms = document.getElementById("id_addresses-TOTAL_FORMS");
    const emptyFormTemplate = document.querySelector("#empty-form-template tr");

    addBtn.addEventListener("click", function () {
      const formCount = parseInt(totalForms.value);
      const newFormHtml = emptyFormTemplate.outerHTML.replace(/__prefix__/g, formCount);
      const temp = document.createElement("tbody");
      temp.innerHTML = newFormHtml;
      formContainer.appendChild(temp.firstElementChild);
      totalForms.value = formCount + 1;
    });
  });



</script>

{% endblock %}
</body>
</html>
